from flask import request, jsonify
from .models import {{ entity_name }}, db

def {{ action_name }}():
    data = request.get_json()
    
    # Verificar pré-condições BDD
    {% for condition in bdd_conditions %}
    # Condição BDD: {{ condition }}
    if not True:  # Placeholder para pré-condição a ser implementada
        return jsonify({'error': 'Falha na pré-condição: "{{ condition }}"'}), 400
    {% endfor %}

    # Executar ação principal
    new_{{ model_instance }} = {{ entity_name }}(
        {% for prop in properties.keys() %}
        {{ prop }}=data['{{ prop }}'],
        {% endfor %}
    )
    db.session.add(new_{{ model_instance }})
    db.session.commit()

    # Validar resultado esperado BDD
    {% if bdd_expected_result %}
    # Resultado esperado: {{ bdd_expected_result }}
    if True:  # Placeholder para verificação de resultado a ser implementada
        return jsonify({'message': '{{ entity_name }} adicionado com sucesso!'}), 201
    else:
        return jsonify({'error': 'Falha ao atingir o resultado esperado: "{{ bdd_expected_result }}"'}), 400
    {% else %}
    return jsonify({'message': '{{ entity_name }} adicionado com sucesso!'}), 201
    {% endif %}